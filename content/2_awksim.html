
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Awkward Arrays for Simulated Data &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/2_awksim';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Combinatronics" href="3_combinatronics.html" />
    <link rel="prev" title="Uproot I/O" href="1_uprootawk.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="../_static/logo.jpg" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Python for High Energy Physics
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="0_dictsarrs.html">Python Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_uprootawk.html">Uproot I/O</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Awkward Arrays for Simulated Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_combinatronics.html">Combinatronics</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_dimuons.html">Dimuons Revisited</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_vecthist.html">Vectors and Multi-dimensional Histograms</a></li>
<li class="toctree-l1"><a class="reference internal" href="project-workbook.html">Project: Discover the Higgs!</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/roy-cruz/PythonHEP-Book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/roy-cruz/PythonHEP-Book/issues/new?title=Issue%20on%20page%20%2Fcontent/2_awksim.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/2_awksim.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Awkward Arrays for Simulated Data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">Loading the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reconstructing-the-mass">Reconstructing the mass</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="awkward-arrays-for-simulated-data">
<h1>Awkward Arrays for Simulated Data<a class="headerlink" href="#awkward-arrays-for-simulated-data" title="Link to this heading">#</a></h1>
<p>In this chapter, we will be using Uproot and Awkard arrays to open and work simulated data.</p>
<section id="loading-the-data">
<h2>Loading the Data<a class="headerlink" href="#loading-the-data" title="Link to this heading">#</a></h2>
<p>First things first: we need the data. Run the following cell to download the simulated data we will be using.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The ! command is used to run shell commands in a Jupyter notebook or similar environment.</span>
<span class="o">!</span>wget<span class="w"> </span>wget<span class="w"> </span>https://cernbox.cern.ch/remote.php/dav/public-files/d0FqsjN68SsBlul/uproot-tutorial-file.root
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">uproot</span>

<span class="n">file</span> <span class="o">=</span> <span class="n">uproot</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
    <span class="s2">&quot;./uproot-tutorial-file.root&quot;</span>
<span class="p">)</span>
<span class="n">file</span><span class="o">.</span><span class="n">classnames</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">uproot.open</span></code> function provides a handle to the ROOT file, but does not actually read any data into memory at this stage. Instead, it allows you to explore the file structure and access its contents on demand. This approach is efficient because it avoids loading large datasets until you specifically request them. For example, after opening the file, you can inspect the available objects (such as TTrees or histograms) and only read the branches or entries you need for your analysis. This lazy-loading behavior is especially useful when working with large high-energy physics datasets.</p>
<p>Now that we have a hande on the ROOT file we want to use, let’s use that to now get a handle on the “Events” TTree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s2">&quot;Events&quot;</span><span class="p">]</span>
<span class="n">tree</span>
</pre></div>
</div>
</div>
</div>
<p>Keep in mind that we still have not read any data. Before doing that, its important that we see what is inside the TTree using the <code class="docutils literal notranslate"><span class="pre">show</span></code> method we learned about in the last chapter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can see that it contains some physics observables. Getting some understanding of this data is important for the next steps we will be taking. The folowing table summarizes what each each observable available to us represents.</p>
  <!-- - `nMuon`: The number of muons in the event
  - `Muon_pt`: The $p_T$ of each of those muons
  - `Muon_eta`: The $\eta$ coordinate of each muon
  - `Muon_phi`: The $\phi$ coordinate of each muon
  - `Muon_mass`: The mass of each muon
  - `Muon_charge`: The charge of each muon -->
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Column name</p></th>
<th class="head"><p>Data type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nMuon</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span></code></p></td>
<td><p>Number of muons in this event</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Muon_pt</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float[nMuon]</span></code></p></td>
<td><p>Transverse momentum of the muons (stored as an array of size <code class="docutils literal notranslate"><span class="pre">nMuon</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Muon_eta</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float[nMuon]</span></code></p></td>
<td><p>Pseudorapidity of the muons</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Muon_phi</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float[nMuon]</span></code></p></td>
<td><p>Azimuth of the muons</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Muon_mass</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float[nMuon]</span></code></p></td>
<td><p>Mass of the muons</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Muon_charge</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int[nMuon]</span></code></p></td>
<td><p>Charge of the muons (either 1 or -1)</p></td>
</tr>
</tbody>
</table>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">Muon_phi</span></code> and <code class="docutils literal notranslate"><span class="pre">Muon_eta</span></code> refers to the corresponding spacial coordinates used in the CMS coordinate system. The following figure illustrates these coordinates in the CMS experiemnt.</p>
<figure class="align-default" id="cmsaxis">
<a class="reference internal image-reference" href="../_images/axis3D_CMS.png"><img alt="../_images/axis3D_CMS.png" src="../_images/axis3D_CMS.png" style="height: 350px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Coordinate system in CMS</span><a class="headerlink" href="#cmsaxis" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>With this in mind, lets go ahead and finally load some data. We can do this by specifying the TBranch we want through the dict-like interphase of <code class="docutils literal notranslate"><span class="pre">tree</span></code> and then using the <code class="docutils literal notranslate"><span class="pre">array</span></code> or <code class="docutils literal notranslate"><span class="pre">arrays</span></code> method that are provided. For now, however, lets only load some of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Only loading 100 events</span>
<span class="n">tree</span><span class="p">[</span><span class="s2">&quot;nMuon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">entry_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">entry_stop</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Alternative: (Not neccessarily the preferred way if you&#39;re only interested in loading a single branch)</span>
<span class="n">tree</span><span class="p">[</span><span class="s2">&quot;nMuon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">arrays</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>If we wanted to load more than a single branch, we could use the <code class="docutils literal notranslate"><span class="pre">arrays</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">event_data</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">([</span><span class="s2">&quot;nMuon&quot;</span><span class="p">,</span> <span class="s2">&quot;Muon_pt&quot;</span><span class="p">],</span> <span class="n">entry_stop</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">event_data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">event_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>Note that what we obtain is rather special and it sort of looks like dictionaries inside an array. The object we are working with is actually an Awkward array, the Awkward library’s equivalent of a NumPy array, which contains Awkard records, the equivalent to a dictionary. This might seem trivial, but this data structure is actually quite powerful. For instance, suppose you want to only get the <code class="docutils literal notranslate"><span class="pre">Muon_pt</span></code> of this loaded data. To do that, you pass a key value in between brakets to the Awkward array, and you will get in return an Awkward array containing the value for that key for every record/event in that array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">event_data</span><span class="p">[</span><span class="s2">&quot;Muon_pt&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Note that we are now dealing with a jagged array. We can work with it similarly to how we work with NumPy arrays.*</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">event_data</span><span class="p">[</span><span class="s2">&quot;Muon_pt&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note: Only possible if there is at least one Muon in each event. Try with `event_data[&quot;nMuon&quot;][:, 0]` to see what happens if we include events with no Muons.</span>
<span class="n">event_data</span><span class="p">[</span><span class="s2">&quot;Muon_pt&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> 
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise</strong>: Print out the <span class="math notranslate nohighlight">\(p_T\)</span> and charge of the muons from events 100 to 115. There are two main ways to do this. Can you figure out what they are? Which method is faster? (Hint: Use the <code class="docutils literal notranslate"><span class="pre">%%timeit</span></code> magic)</p>
<p>Before moving on to exploring the data, its important to keep something in mind: because the data we typically deal with is quite large, unless neccesary, its good practice to specify the particular TBranches you want instead of doing something like <code class="docutils literal notranslate"><span class="pre">tree.arrays()</span></code> as this will load in everything, including things you might not be interested in. We already saw one way of loading specific branches, namely:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">([</span><span class="s2">&quot;nMuon&quot;</span><span class="p">,</span> <span class="s2">&quot;Muon_pt&quot;</span><span class="p">],</span> <span class="n">entry_stop</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Another way would be:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">filter_name</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nMuon&quot;</span><span class="p">,</span> <span class="s2">&quot;Muon_pt&quot;</span><span class="p">],</span> <span class="n">entry_stop</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that we can also use wildcards in the TBranch filter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">filter_name</span><span class="o">=</span><span class="s2">&quot;Muon_*&quot;</span><span class="p">,</span> <span class="n">entry_stop</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If your TTree has a lot of branches, and <code class="docutils literal notranslate"><span class="pre">show</span></code> is impractical, you can also use <code class="docutils literal notranslate"><span class="pre">tree.keys</span></code>, which also accepts <code class="docutils literal notranslate"><span class="pre">filter_name</span></code> with wildcards. Then you can also verify the data type contained in each column by doing <code class="docutils literal notranslate"><span class="pre">tree.typenames()</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note: No filtering. But that&#39;s okay, because we&#39;re not reading data here.</span>
<span class="n">tree</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span><span class="o">.</span><span class="n">typenames</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Just like the <code class="docutils literal notranslate"><span class="pre">arrays</span></code> method, methods accept a <code class="docutils literal notranslate"><span class="pre">filter_name</span></code> argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">filter_name</span><span class="o">=</span><span class="s2">&quot;Muon_*&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree</span><span class="o">.</span><span class="n">typenames</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>As a last point, for pedagogical purposes, we can also load the data in the form of a Pandas DataFrame, which will highlight the tabular nature of the data. Note, however, that doing this is not usual, and it is usually preferrable to use Awkward Arrays to handle your data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">library</span><span class="o">=</span><span class="s2">&quot;pd&quot;</span><span class="p">,</span> <span class="n">entry_stop</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="reconstructing-the-mass">
<h2>Reconstructing the mass<a class="headerlink" href="#reconstructing-the-mass" title="Link to this heading">#</a></h2>
<p>Now that we know what the branches look like and what is the data type each one contains, let’s explore the data and try to do something useful with it. Note that the data contains physical observables for muons in each collision event. What would happen if we add the mass of two muons in an event? Let’s find out! First, lets load a sub-set of the events contained in the sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loading in some data from all branches</span>
<span class="n">muons</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">entry_stop</span><span class="o">=</span><span class="mi">1500</span><span class="p">)</span>
<span class="n">muons</span>
</pre></div>
</div>
</div>
</div>
<p>Just for simplicity, let’s ensure there are two muons in each event. Later on, we will do something more sophisticated. To do this, we can create a filer or mask similarly to how we created masks for NumPy arrays. What we want is for mask to be <code class="docutils literal notranslate"><span class="pre">True</span></code> when an event has exactly 2 events, and <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise. Fortunately, we have the field <code class="docutils literal notranslate"><span class="pre">nMuon</span></code> which immediately provides us with the information we need to construct this mask as follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If an event has 2 muons, its corresponding element in the mask is True. False otherwise.</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">muons</span><span class="p">[</span><span class="s2">&quot;nMuon&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>
<span class="n">mask</span>
</pre></div>
</div>
</div>
</div>
<p>We can now apply this mask the exact same way we applied masks with NumPy array!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Only keeping di-muon events</span>
<span class="n">dimuons</span> <span class="o">=</span> <span class="n">muons</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">dimuons</span>
</pre></div>
</div>
</div>
</div>
<p>We can make sure that the resulting filtered array only has events with two muons by using the function <code class="docutils literal notranslate"><span class="pre">ak.all</span></code> provided by Awkward. This function takes in an array of booleans (although not neccesary that the elements are booleans), and tells you whether <em>all</em> elements are <code class="docutils literal notranslate"><span class="pre">True</span></code>. This would be equivalent to applying the <code class="docutils literal notranslate"><span class="pre">AND</span></code> boolean operator over the whole array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">awkward</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ak</span>
<span class="n">ak</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;nMuon&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s now get the observables into their own variables for future convenience.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Getting the eta, pt and phi of each of the muons in the dimuon events</span>
<span class="n">pt0</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_pt&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pt1</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_pt&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">eta0</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_eta&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">eta1</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_eta&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">phi0</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_phi&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">phi1</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_phi&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s assume the two muons came from the decay of a particle <span class="math notranslate nohighlight">\(A\)</span>. We make use of the fact that the square of the total 4-momentum of the system is an invariant quantity to establish that</p>
<div class="math notranslate nohighlight">
\[(p_A)^\nu (p_A)_\nu = (p_1+p_2)^\sigma (p_1+p_2)_\sigma\]</div>
<p>where the left side comes from the initial state of the system, in an inertial reference frame where the <span class="math notranslate nohighlight">\(A\)</span> is stationary, and the right side corresponds to the final state of the system (i.e., when we have two muons) in the lab reference frame. This reduces to:</p>
<div class="math notranslate nohighlight">
\[m_{A} = \sqrt{(E_1 + E_2)^2 - \|\textbf{p}_1 + \textbf{p}_2 \| ^2} = \sqrt{(E_1+E_2)^2-((p_{1_x}+p_{2_x})^2+(p_{1_y}+p_{2_y})^2+(p_{1_z}+p_{2_z})^2)}|\]</div>
<p>which, under the assumption that <span class="math notranslate nohighlight">\(E \gg m\)</span> (i.e., <span class="math notranslate nohighlight">\(E^2 = p^2 + m^2 \approx p^2\)</span>), and changing the coordinates this equation is written in, this reduces to:</p>
<div class="math notranslate nohighlight">
\[m_{A} = \sqrt{
    2p_{T,0} p_{T,1} * \left(\cosh(\eta_0 - \eta_1) - \cos(\phi_0- \phi_1)\right)
}\]</div>
<p>We can then use this equation to compute the mass of the hypothetical particle these pairs of muons came from. This is easy to do with Awkward arrays!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pt0</span> <span class="o">*</span> <span class="n">pt1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">eta0</span> <span class="o">-</span> <span class="n">eta1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi0</span> <span class="o">-</span> <span class="n">phi1</span><span class="p">)))</span>
<span class="n">mass</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise:</strong> The <code class="docutils literal notranslate"><span class="pre">dimuon</span></code> array we constructed to reconstruct the mass only has a single filter applied to it which makes sure there are exactly two muons in each event. Why is this a problem? What other things might we want to ensure from the muons that we will use to reconstruct the mass of <span class="math notranslate nohighlight">\(A\)</span> particle?</p>
<p>The raw data for the reconstructed mass is difficult to interpret without an effective way to visualize it. One of the most common tools in a high energy physicist’s toolkit is the histogram. Histograms display the frequency of data values within specified ranges (bins). This allows us to see the distribution and identify features such as peaks or tails in the data and will make it much easier for us to understand the underlying physics represented by the reconstructed mass values.</p>
<p>To make the histogram, we will use the Hist library, one of the many tools offered by Scikit-HEP. This library offers a user-friendly API for the Boost-histogram Python library which offers a highly efficient and flexible histogramming framework. You can find detailed information about this libarry in the documentation, which you can access through this link: <a class="reference external" href="https://hist.readthedocs.io/en/latest/user-guide/axes.html">link</a>.</p>
<p>In addition, to easily make our plot look pretty and to follow the conventions used in HEP publications, we will use the <code class="docutils literal notranslate"><span class="pre">mplhep</span></code> library, also from Scikit-HEP. This library provides convenient plotting styles and functions for HEP data, making it straightforward to produce publication-quality figures that match the look and feel of experiments like CMS or ATLAS. By combining <code class="docutils literal notranslate"><span class="pre">Hist</span></code> for efficient histogramming and <code class="docutils literal notranslate"><span class="pre">mplhep</span></code> for styling, we can quickly generate insightful and professional plots of our reconstructed mass distributions.</p>
<p>Under the hood, Hist actually uses Matplotlib to render plots, which means we can take advantage of all the customization and flexibility that Matplotlib offers. Thus, we will import Matplotlib as well to get full access to the plotting tools that this library has to offer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">hist</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mplhep</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hep</span>
<span class="n">hep</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;CMS&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s create a histogram object (i.e., <code class="docutils literal notranslate"><span class="pre">hist.Hist</span></code>) with a single axis. We do this as follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">masshist</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">Hist</span><span class="p">(</span>
    <span class="n">hist</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">Regular</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mass [GeV]&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mass&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If we were to plot the histogram right now, we would see that it would be empty, as we have not put any data into it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">masshist</span>
</pre></div>
</div>
</div>
</div>
<p>To add our data, we use the <code class="docutils literal notranslate"><span class="pre">fill</span></code> method and pass the array of the reconstructed masses we made. This method immediately returns the histogram, from which we can get a glimpse of how it looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">masshist</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To make a proper plot of this histogram, we will use Matplotlib to create a figure with an axis, and then use the <code class="docutils literal notranslate"><span class="pre">plot1d</span></code> method of the <code class="docutils literal notranslate"><span class="pre">hist.Hist</span></code> object to plot the histogram we have created on those axis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using Hist + Matplotlib</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">masshist</span><span class="o">.</span><span class="n">plot1d</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Dimuon mass [GeV]&quot;</span><span class="p">,</span> 
<span class="p">)</span>

<span class="c1"># Adding label for the y-axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
<span class="c1"># Adding axis title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Dimuon Mass Distribution&quot;</span><span class="p">)</span>
<span class="c1"># Adding legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>From this plot, we see multiple peaks. Notice, however that there is a peak very near <span class="math notranslate nohighlight">\(90 \text{ GeV}\)</span>. This corresponds to the mass of the Z boson, and it means that we have been able to reconstruct its mass even though our approach was quite rudimentary. We can confirm the exact value for the mass of the Z boson by using the particle Particle library which provides particle data from the Particle Data Group (<a class="reference external" href="https://pdg.lbl.gov/">PDF website</a>). We will also use the <code class="docutils literal notranslate"><span class="pre">hepunits</span></code> library which provivdes units and constants for the HEP system of units.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">particle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hepunits</span><span class="w"> </span><span class="kn">import</span> <span class="n">GeV</span>

<span class="c1"># Getting the mass of the Z boson</span>
<span class="n">z_mass</span> <span class="o">=</span> <span class="n">particle</span><span class="o">.</span><span class="n">Particle</span><span class="o">.</span><span class="n">from_name</span><span class="p">(</span><span class="s2">&quot;Z0&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Z boson mass in GeV:&quot;</span><span class="p">,</span> <span class="n">z_mass</span><span class="o">.</span><span class="n">mass</span> <span class="o">/</span> <span class="n">GeV</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can also make the previous histogram, but now lets add a vertical line on the Z mass for emphasis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting a a vertical line at the Z boson mass</span>
<span class="c1"># Using Hist + Matplotlib</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">masshist</span><span class="o">.</span><span class="n">plot1d</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Dimuon mass [GeV]&quot;</span><span class="p">,</span> 
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Dimuon Mass Distribution&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">z_mass</span><span class="o">.</span><span class="n">mass</span> <span class="o">/</span> <span class="n">GeV</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Z boson mass&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">z_mass</span><span class="o">.</span><span class="n">mass</span> <span class="o">/</span> <span class="n">GeV</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;Z boson mass&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>While we have been successful at reconstructing the mass of the Z boson to some extent, our approach is quite basic. First, we excluded many events that have more than two muons, even though some of these events might contain two or more muons that originated from a Z boson. Additionally, we did not ensure that quantities such as charge were conserved. We simply added the masses of the muons without verifying these important details. We will address these considerations in the next chapter. For now, lets review once again the code we have developed so far for reconstructing the masses.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loading data</span>
<span class="n">muons</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span><span class="n">filter_name</span><span class="o">=</span><span class="s2">&quot;/nMuon|Muon_(phi|eta|pt)/&quot;</span><span class="p">,</span> <span class="n">entry_stop</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>

<span class="c1"># Applying a cut</span>
<span class="n">dimuons_cut</span> <span class="o">=</span> <span class="n">muons</span><span class="p">[</span><span class="s2">&quot;nMuon&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>
<span class="n">dimuons</span> <span class="o">=</span> <span class="n">muons</span><span class="p">[</span><span class="n">dimuons_cut</span><span class="p">]</span>

<span class="c1"># Getting the eta, pt and phi of each of the muons in the dimuon events</span>
<span class="n">pt0</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_pt&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pt1</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_pt&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">eta0</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_eta&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">eta1</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_eta&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">phi0</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_phi&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">phi1</span> <span class="o">=</span> <span class="n">dimuons</span><span class="p">[</span><span class="s2">&quot;Muon_phi&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Calculating the mass of the dimuon system</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pt0</span> <span class="o">*</span> <span class="n">pt1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">eta0</span> <span class="o">-</span> <span class="n">eta1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi0</span> <span class="o">-</span> <span class="n">phi1</span><span class="p">)))</span>

<span class="c1"># Plotting the mass distribution using Hist + Matplotlib</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">masshist</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">Hist</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">Regular</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;mass [GeV]&quot;</span><span class="p">))</span>
<span class="n">masshist</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span>
<span class="n">masshist</span><span class="o">.</span><span class="n">plot1d</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Dimuon Mass&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$m_{\mu\mu}$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>For the rest of this workshop, we will focus on the Z and Higgs boson. However, you might be wondering what those extra peaks are to the left of the Z peak. To emphasize these peaks, let’s make the plot logarithmic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># Note: Making a logarithmic hist axis (i.e. hist with variable binning)</span>
<span class="n">hist_data</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">Hist</span><span class="p">(</span>
    <span class="n">hist</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="mi">100</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mass&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Invariant Mass [GeV]&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">hist_data</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">mass</span><span class="o">=</span><span class="n">mass</span><span class="p">)</span>
<span class="n">hist_data</span><span class="o">.</span><span class="n">plot1d</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Invariant Mass [GeV]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Dimuon Invariant Mass Distribution&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Compare this to this cleaner dimuon mass spectrum with labels identifying what each peak corresponds to.</p>
<figure class="align-default" id="dimuon-spectrum">
<a class="reference internal image-reference" href="../_images/dimuonspectrumplt.png"><img alt="../_images/dimuonspectrumplt.png" src="../_images/dimuonspectrumplt.png" style="height: 350px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Dimuon mass spectrum</span><a class="headerlink" href="#dimuon-spectrum" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p><strong>Exercise</strong>: Take the non-logarithmic version of the dimuon spectrum histogram plot we made and modify it by changing the following three things:</p>
<ul class="simple">
<li><p>Change the color and style of the histogram line.</p></li>
<li><p>Add grid lines to the plot for better readability.</p></li>
<li><p>Adjust the x-axis range to focus on the region around the Z boson peak (e.g., 60 to 120 GeV).</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="1_uprootawk.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Uproot I/O</p>
      </div>
    </a>
    <a class="right-next"
       href="3_combinatronics.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Combinatronics</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">Loading the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reconstructing-the-mass">Reconstructing the mass</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>